<!DOCTYPE html>
<html lang="it">

<head>
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' https://*.firebaseapp.com https://*.googleapis.com; script-src 'self' https://*.firebaseapp.com https://apis.google.com https://www.googletagmanager.com https://www.gstatic.com https://cdnjs.cloudflare.com 'sha256-vvt4KWwuNr51XfE5m+hzeNEGhiOfZzG97ccfqGsPwvE='; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https://*; connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://www.gstatic.com wss://*.firebaseio.com; frame-src 'self' https://*.firebaseapp.com https://www.gstatic.com;">
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Componi Scadenza - PROTOCOLLO BASE V4.1</title>
    <link rel="manifest" href="manifest.json?v=4.1" />
    <link rel="apple-touch-icon" sizes="192x192" href="assets/images/app-icon.png">

    <!-- Design System Master (PROTOCOLLO V5.0) -->
    <link rel="stylesheet" href="assets/css/core.css?v=5.0">
    <link rel="stylesheet" href="assets/css/core_fonts.css">
    <link rel="stylesheet" href="assets/css/core_fascie.css">
    <link rel="stylesheet" href="assets/css/aggiungi_scadenza.css?v=5.0">

    <!-- CORE JS -->
    <script src="assets/js/core.js"></script>
    <script type="module" src="assets/js/ui-core.js"></script>
    <script src="assets/js/theme-init.js"></script>
</head>

<body class="base-bg">
    <div class="base-container">
        <!-- Ambient Glow -->
        <div class="base-glow"></div>

        <!-- Automated Header -->
        <header id="header-placeholder" class="base-header"></header>

        <main class="base-main">
            <div class="page-container pt-header-extra pb-footer-extra">

                <!-- Header Pagina e Mode Switch -->
                <div class="detail-header-container">
                    <span class="detail-page-label" data-t="planning">Pianificazione Scadenze</span>
                    <div class="detail-header-row mb-4">
                        <h1 class="detail-title-value" data-t="compose_deadline">Componi Scadenza</h1>
                    </div>

                    <!-- Mode Selector Tab Style -->
                    <div class="mode-selector-tabs">
                        <button type="button" id="mode-automezzi" class="mode-tab active" data-mode="automezzi">
                            <span class="material-symbols-outlined">directions_car</span>
                            <span data-t="vehicles">Automezzi</span>
                        </button>
                        <button type="button" id="mode-documenti" class="mode-tab" data-mode="documenti">
                            <span class="material-symbols-outlined">badge</span>
                            <span data-t="documents">Documenti</span>
                        </button>
                        <button type="button" id="mode-generali" class="mode-tab" data-mode="generali">
                            <span class="material-symbols-outlined">event_note</span>
                            <span data-t="general">Generali</span>
                        </button>
                    </div>
                </div>

                <!-- 1. Dati Principali -->
                <div class="detail-section">
                    <div class="detail-section-header">
                        <span class="material-symbols-outlined icon-blue">edit_calendar</span>
                        <h3 class="detail-section-title" data-t="deadline_info">Dati Scadenza</h3>
                    </div>

                    <div class="detail-list-group p-4 flex-col-gap-4">
                        <!-- Intestatario / Nominativo -->
                        <div class="form-group">
                            <label class="label-sm" data-t="holder">Intestatario / Nominativo</label>
                            <div class="input-wrapper">
                                <span class="material-symbols-outlined">person</span>
                                <input id="nome_cognome" list="names-list" type="text" class="input"
                                    placeholder="Mario Rossi">
                                <datalist id="names-list"></datalist>
                            </div>
                        </div>

                        <!-- Categoria / Oggetto (Custom Dropdown Proxy) -->
                        <div class="form-group">
                            <label class="label-sm" data-t="category_object">Categoria / Oggetto Scadenza</label>
                            <div class="base-dropdown w-full" data-custom-select="tipo_scadenza">
                                <button type="button" class="base-btn-secondary dropdown-trigger">
                                    <div class="flex-align-center gap-2 overflow-hidden">
                                        <span class="material-symbols-outlined opacity-50 flex-shrink-0">category</span>
                                        <span class="dropdown-label truncate" data-t="select_category">Seleziona
                                            categoria...</span>
                                    </div>
                                    <span class="material-symbols-outlined arrow-icon flex-shrink-0">expand_more</span>
                                </button>
                                <div class="base-dropdown-menu scrollable role-menu"></div>
                                <select id="tipo_scadenza" class="hidden"></select>
                            </div>
                        </div>

                        <!-- Veicolo / Dettaglio (Custom Dropdown Proxy) -->
                        <div id="vehicle_fields_wrapper" class="form-group hidden">
                            <label class="label-sm" id="vehicle-label-text" data-t="vehicle_extra">Dettaglio Veicolo /
                                Altro</label>
                            <div class="base-dropdown w-full" data-custom-select="modello_veicolo">
                                <button type="button" class="base-btn-secondary dropdown-trigger">
                                    <div class="flex-align-center gap-2 overflow-hidden">
                                        <span class="material-symbols-outlined opacity-50 flex-shrink-0"
                                            id="vehicle-icon">directions_car</span>
                                        <span class="dropdown-label truncate" data-t="select_detail">Seleziona
                                            dettaglio...</span>
                                    </div>
                                    <span class="material-symbols-outlined arrow-icon flex-shrink-0">expand_more</span>
                                </button>
                                <div class="base-dropdown-menu scrollable role-menu"></div>
                                <select id="modello_veicolo" class="hidden"></select>
                            </div>
                        </div>

                        <!-- Template Messaggio (Custom Dropdown Proxy) -->
                        <div id="testo_email_wrapper" class="form-group hidden">
                            <label class="label-sm" data-t="email_template">Template Messaggio</label>
                            <div class="base-dropdown w-full" data-custom-select="testo_email_select">
                                <button type="button" class="base-btn-secondary dropdown-trigger">
                                    <div class="flex-align-center gap-2 overflow-hidden">
                                        <span
                                            class="material-symbols-outlined opacity-50 flex-shrink-0">description</span>
                                        <span class="dropdown-label truncate" data-t="select_template">Seleziona
                                            template...</span>
                                    </div>
                                    <span class="material-symbols-outlined arrow-icon flex-shrink-0">expand_more</span>
                                </button>
                                <div class="base-dropdown-menu scrollable role-menu"></div>
                                <select id="testo_email_select" class="hidden"></select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Date & Notifiche -->
                <div class="detail-section mt-4">
                    <div class="detail-section-header">
                        <span class="material-symbols-outlined icon-amber">notifications_active</span>
                        <h3 class="detail-section-title" data-t="date_alerts">Pianificazione</h3>
                    </div>

                    <div class="detail-list-group p-4 flex-col-gap-4">
                        <div class="form-grid-2">
                            <!-- Data Scadenza -->
                            <div class="form-group">
                                <label class="label-sm" data-t="expiry_date">Data Scadenza</label>
                                <div class="input-wrapper">
                                    <span class="material-symbols-outlined">calendar_today</span>
                                    <input id="dueDate" type="date" class="input">
                                </div>
                            </div>

                            <!-- Anteprima Oggetto -->
                            <div class="form-group">
                                <label class="label-sm" data-t="email_subject_preview">Anteprima Oggetto</label>
                                <div class="input-wrapper bg-soft-glass opacity-60">
                                    <input id="oggetto_email" readonly type="text" class="input italic text-xs"
                                        placeholder="Oggetto automatico...">
                                </div>
                            </div>
                        </div>

                        <!-- Stat Grid for Preavviso e Frequenza (Semantic) -->
                        <div class="form-grid-2 mt-2">
                            <div class="planning-info-box">
                                <div class="planning-icon-box bg-blue-500/10">
                                    <span class="material-symbols-outlined">timer</span>
                                </div>
                                <div class="planning-text-box">
                                    <span class="planning-label" data-t="notice_days">GG Preavviso</span>
                                    <span id="display_notif_days" class="planning-value">14</span>
                                    <input id="notif_days_before" type="hidden" value="14">
                                </div>
                            </div>
                            <div class="planning-info-box">
                                <div class="planning-icon-box bg-purple-500/10">
                                    <span class="material-symbols-outlined">update</span>
                                </div>
                                <div class="planning-text-box">
                                    <span class="planning-label" data-t="frequency_days">GG Frequenza</span>
                                    <span id="display_notif_freq" class="planning-value">7</span>
                                    <input id="notif_frequency" type="hidden" value="7">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Destinatari -->
                <div class="detail-section mt-4">
                    <div class="detail-section-header">
                        <span class="material-symbols-outlined icon-emerald">alternate_email</span>
                        <h3 class="detail-section-title" data-t="notification_recipients">Destinatari Notifica</h3>
                    </div>

                    <div class="detail-list-group p-4 flex-col-gap-4">
                        <!-- Email Primaria (Custom Dropdown Proxy) -->
                        <div class="form-group">
                            <label class="label-sm" data-t="primary_email">Email Primaria</label>
                            <div class="flex-col-gap-2">
                                <div class="base-dropdown w-full" data-custom-select="email_primaria_select">
                                    <button type="button" class="base-btn-secondary dropdown-trigger">
                                        <div class="flex-align-center gap-2 overflow-hidden">
                                            <span class="material-symbols-outlined opacity-50 flex-shrink-0">mail</span>
                                            <span class="dropdown-label truncate"
                                                data-t="select_email">Seleziona...</span>
                                        </div>
                                        <span
                                            class="material-symbols-outlined arrow-icon flex-shrink-0">expand_more</span>
                                    </button>
                                    <div class="base-dropdown-menu scrollable role-menu"></div>
                                    <select id="email_primaria_select" class="hidden"></select>
                                </div>
                                <input id="email_primaria_input" type="email" class="input hidden mt-2"
                                    placeholder="Inserisci email manuale...">
                            </div>
                        </div>

                        <!-- Email Secondaria (Custom Dropdown Proxy) -->
                        <div class="form-group">
                            <label class="label-sm" data-t="secondary_email">Email Secondaria (Opz.)</label>
                            <div class="flex-col-gap-2">
                                <div class="base-dropdown w-full" data-custom-select="email_secondaria_select">
                                    <button type="button" class="base-btn-secondary dropdown-trigger">
                                        <div class="flex-align-center gap-2 overflow-hidden">
                                            <span
                                                class="material-symbols-outlined opacity-50 flex-shrink-0">forward_to_inbox</span>
                                            <span class="dropdown-label truncate"
                                                data-t="select_email">Seleziona...</span>
                                        </div>
                                        <span
                                            class="material-symbols-outlined arrow-icon flex-shrink-0">expand_more</span>
                                    </button>
                                    <div class="base-dropdown-menu scrollable role-menu"></div>
                                    <select id="email_secondaria_select" class="hidden"></select>
                                </div>
                                <input id="email_secondaria_input" type="email" class="input hidden mt-2"
                                    placeholder="Inserisci email manuale...">
                            </div>
                        </div>

                        <!-- WhatsApp Beta Toggle -->
                        <div class="whatsapp-toggle-card mt-2">
                            <div class="flex-align-center gap-3">
                                <div class="planning-icon-box bg-emerald-500/10">
                                    <span class="material-symbols-outlined">chat</span>
                                </div>
                                <div>
                                    <span class="block text-sm font-bold" data-t="whatsapp_beta">WhatsApp (Beta)</span>
                                    <span class="block text-xs opacity-40 uppercase" data-t="whatsapp_desc">Notifica
                                        automatica</span>
                                </div>
                            </div>
                            <label class="cursor-pointer">
                                <input type="checkbox" id="whatsapp_enable" class="base-switch-hidden">
                                <div class="base-switch"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 4. Allegati & Note -->
                <div class="detail-section mt-4 mb-20">
                    <div class="detail-section-header">
                        <h3 class="detail-section-title" data-t="attachments_notes">Allegati & Note</h3>
                    </div>

                    <div class="detail-list-group p-4 flex-col-gap-4">
                        <!-- Note -->
                        <div class="form-group">
                            <label class="label-sm" data-t="notes">Note Aggiuntive</label>
                            <div class="detail-notes-box">
                                <textarea id="notes" class="input-textarea"
                                    placeholder="Dettagli sulla scadenza..."></textarea>
                            </div>
                        </div>

                        <!-- Allegati Logic Wrapper (Premium V4.1) -->
                        <div id="attachments-section" class="flex-col-gap-4">
                            <!-- Premium Upload Trigger -->
                            <button type="button" id="btn-trigger-upload" class="btn-upload-trigger">
                                <div class="flex-align-center gap-3 w-full">
                                    <span class="material-symbols-outlined text-blue-500">attach_file</span>
                                    <div class="text-left">
                                        <span class="block text-sm font-bold text-white">Aggiungi Allegato</span>
                                    </div>
                                </div>
                            </button>

                            <!-- Attachments List (Sotto il pulsante) -->
                            <div id="attachments-list" class="flex-col-gap-2">
                                <!-- Injected via JS -->
                                <p class="placeholder-text-standard">
                                    Nessun allegato
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>

        <!-- Automated Footer -->
        <footer id="footer-placeholder" class="base-footer"></footer>
    </div>

    <!-- Hidden File Inputs -->
    <input type="file" id="input-camera" accept="image/*" capture="environment" class="hidden"
        aria-label="Upload da Camera">
    <input type="file" id="input-gallery" accept="image/*,video/*" class="hidden" aria-label="Upload da Galleria">
    <input type="file" id="input-file" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt" class="hidden"
        aria-label="Upload Documento">

    <!-- Source Selector Modal (Semantic) -->
    <div id="source-selector-modal" class="modal-overlay">
        <div class="source-modal-box modal-box">
            <h3 class="text-xs font-extra-bold uppercase tracking-widest text-center mb-5 opacity-40 text-white">
                Seleziona Sorgente</h3>

            <div class="modal-grid">
                <button type="button" class="source-option-btn" data-source="camera">
                    <span class="material-symbols-outlined">photo_camera</span>
                    <span class="text-xs font-bold uppercase tracking-wider opacity-60">Camera</span>
                </button>

                <button type="button" class="source-option-btn" data-source="gallery">
                    <span class="material-symbols-outlined">collections</span>
                    <span class="text-xs font-bold uppercase tracking-wider opacity-60">Galleria</span>
                </button>

                <button type="button" class="source-option-btn full-width flex-align-center gap-4" data-source="file">
                    <span class="material-symbols-outlined">description</span>
                    <span class="text-xs font-bold uppercase tracking-wider opacity-60">Documento</span>
                </button>
            </div>

            <button type="button" id="btn-cancel-source" class="source-btn-cancel">
                Annulla
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="assets/js/main.js"></script>
    <script type="module" src="assets/js/modules/scadenze/aggiungi_scadenza.js"></script>
</body>

</html>